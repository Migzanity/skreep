-- Keybind to open for PC is "comma" -> " , "
-- Made by Gi#7331

-- Notify the user with a tip
game:GetService("StarterGui"):SetCore("SendNotification", {
    Title = "Tips!",
    Text = "Wait 1 - 15 seconds to show GUI. If it doesn't show, try executing again.",
    Duration = 15
})

-- Destroy existing Emotes GUI if it exists
if game:GetService("CoreGui"):FindFirstChild("Emotes") then
    game:GetService("CoreGui"):FindFirstChild("Emotes"):Destroy()
end

-- Services
local ContextActionService = game:GetService("ContextActionService")
local HttpService = game:GetService("HttpService")
local GuiService = game:GetService("GuiService")
local CoreGui = game:GetService("CoreGui")
local MarketplaceService = game:GetService("MarketplaceService")
local Players = game:GetService("Players")
local StarterGui = game:GetService("StarterGui")
local UserInputService = game:GetService("UserInputService")

local Emotes = {}
local LoadedEmotes = {}
local FavoritedEmotes = {}

-- Utility to add emote
local function AddEmote(name, id, price)
    LoadedEmotes[id] = false
    task.spawn(function()
        if not name or not id then return end

        -- Fetch product info
        local success, date = pcall(function()
            local info = MarketplaceService:GetProductInfo(id)
            return DateTime.fromIsoDate(info.Updated):ToUniversalTime()
        end)

        if not success then
            task.wait(10)
            AddEmote(name, id, price)
            return
        end

        -- Convert date to UNIX timestamp
        local unix = os.time({
            year = date.Year,
            month = date.Month,
            day = date.Day,
            hour = date.Hour,
            min = date.Minute,
            sec = date.Second
        })

        LoadedEmotes[id] = true
        table.insert(Emotes, {
            name = name,
            id = id,
            icon = "rbxthumb://type=Asset&id=" .. id .. "&w=150&h=150",
            price = price or 0,
            lastupdated = unix,
            sort = {}
        })
    end)
end

-- Screen GUI
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "Emotes"
ScreenGui.DisplayOrder = 2
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
ScreenGui.Enabled = true

-- BackFrame (Main GUI Frame)
local BackFrame = Instance.new("Frame")
BackFrame.Size = UDim2.new(0.9, 0, 0.5, 0)
BackFrame.AnchorPoint = Vector2.new(0.5, 0.5)
BackFrame.Position = UDim2.new(0.5, 0, 0.5, 0)
BackFrame.BackgroundTransparency = 1
BackFrame.BorderSizePixel = 0
BackFrame.Parent = ScreenGui

-- Button to open/close the GUI
local OpenButton = Instance.new("TextButton")
OpenButton.Name = "Open"
OpenButton.Parent = ScreenGui
OpenButton.Draggable = true
OpenButton.Size = UDim2.new(0.05, 0, 0.114, 0)
OpenButton.Position = UDim2.new(0.05, 0, 0.25, 0)
OpenButton.Text = "Close"
OpenButton.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
OpenButton.TextColor3 = Color3.fromRGB(255, 255, 255)
OpenButton.TextScaled = true
OpenButton.BackgroundTransparency = .5
local UICorner = Instance.new("UICorner", OpenButton)
UICorner.CornerRadius = UDim.new(1, 0)

OpenButton.MouseButton1Click:Connect(function()
    if OpenButton.Text == "Open" then
        OpenButton.Text = "Close"
        BackFrame.Visible = true
    else
        OpenButton.Text = "Open"
        BackFrame.Visible = false
    end
end)

-- Emote name display
local EmoteName = Instance.new("TextLabel")
EmoteName.Name = "EmoteName"
EmoteName.TextScaled = true
EmoteName.AnchorPoint = Vector2.new(0.5, 0.5)
EmoteName.Position = UDim2.new(-0.1, 0, 0.5, 0)
EmoteName.Size = UDim2.new(0.2, 0, 0.2, 0)
EmoteName.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
EmoteName.TextColor3
